# ==============================
# Optimized cleaned and annotated tmux configuration
# Target: macOS / Linux, modern terminals, Vim-centric workflow
# ==============================

##### Terminal & Color Support
# Enable true color (24-bit RGB) for all *-256color terminals
# Required for modern themes like tokyo-night
set -ga terminal-overrides ",*-256color*:TC"

##### General Behavior
# Enable mouse support (pane resize, selection, scrolling)
set -g mouse on

# Use vi-style keys in copy mode and prompts
set -g mode-keys vi

# Start window and pane numbering at 1 (not 0)
set -g base-index 1
set -g pane-base-index 1

# Automatically renumber windows after close
set -g renumber-windows on

# Place the status bar at the top
set -g status-position top

##### Prefix Key
# Replace default prefix (C-b) with C-a (screen-style)
unbind C-b
set -g prefix C-a

# Allow sending literal C-a to applications (C-a C-a)
bind-key C-a send-prefix

##### Reload Configuration
# Reload tmux config without restarting sessions
unbind r
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "tmux config reloaded"

##### Window Navigation
# Shift + Arrow switches windows (no prefix required)
bind-key -n S-Left  previous-window
bind-key -n S-Right next-window

##### Pane Management
# Tree view: sessions + windows, sorted by name, zoomed
bind-key s choose-tree -swZ -O name

# Split panes in current working directory
unbind '%'
bind-key | split-window -h -c "#{pane_current_path}"

unbind '"'
bind-key - split-window -v -c "#{pane_current_path}"

# Toggle pane zoom (maximize / restore)
# Note: -r intentionally omitted (toggle command)
bind-key m resize-pane -Z

# Resize panes (repeatable, Vim-friendly)
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# Pane navigation without prefix (Alt + arrows)
bind-key -n M-Left  select-pane -L
bind-key -n M-Right select-pane -R
bind-key -n M-Up    select-pane -U
bind-key -n M-Down  select-pane -D

# Pane navigation with prefix (Vim-style)
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Kill current pane
unbind x
bind-key x kill-pane

##### Copy Mode (Vim-like)
# Enter visual selection
bind-key -T copy-mode-vi v   send-keys -X begin-selection

# Toggle block (rectangle) selection
# Warning: C-v may be intercepted by terminal paste on some systems
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Yank selection and exit copy mode
bind-key -T copy-mode-vi y   send-keys -X copy-selection-and-cancel

# (Optional but recommended) Sync tmux buffer with system clipboard (tmux >= 3.2)
set -g set-clipboard on

##### Vim ↔ tmux Navigation (Plugin)
# Seamless navigation between Vim splits and tmux panes
set -g @vim_navigator_mapping_left  "C-h C-Left"
set -g @vim_navigator_mapping_right "C-l C-Right"
set -g @vim_navigator_mapping_up    "C-k"
set -g @vim_navigator_mapping_down  "C-j"

# Remove default C-\ mapping to avoid conflicts
set -g @vim_navigator_mapping_prev ""

##### Tokyo Night Theme
# Theme variant
set -g @tokyo-night-tmux_theme "night"

# Status bar options
set -g @tokyo-night-tmux_numbers true
set -g @tokyo-night-tmux_window_id_style fsquare

# Widgets
set -g @tokyo-night-tmux_show_music 1
set -g @tokyo-night-tmux_show_netspeed 0
set -g @tokyo-night-tmux_show_datetime 1
set -g @tokyo-night-tmux_show_battery_widget 1
set -g @tokyo-night-tmux_show_path 1

# Platform-specific widget configuration
# macOS: en0, Linux: e.g. eth0 / wlan0
set -g @tokyo-night-tmux_netspeed_iface "en0"

# macOS: InternalBattery-0, Linux commonly: BAT0
set -g @tokyo-night-tmux_battery_name "InternalBattery-0"
set -g @tokyo-night-tmux_battery_low_threshold 21

# Path display style
set -g @tokyo-night-tmux_path_format relative

##### TPM (Tmux Plugin Manager)
# Homebrew-specific TPM plugin directory
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOMEBREW_PREFIX/opt/tpm/share/tpm/plugins/"

# Plugin list
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'jimeh/tmuxifier'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'janoamaral/tokyo-night-tmux'
set -g @plugin 'alexwforsythe/tmux-which-key'

# Uncomment ONLY if you enable the plugins
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'

# Initialize TPM (must remain last)
run "$HOMEBREW_PREFIX/opt/tpm/share/tpm/tpm"

# ==============================

# Conflict-free keymap summary
# ------------------------------
# Prefix          : C-a
# Reload config   : C-a r
# Split panes     : |  -
# Zoom pane       : C-a m
# Resize panes    : C-a H J K L
# Move panes      : C-a h j k l  |  Alt + arrows
# Switch windows  : Shift + Left / Right
# Copy mode       : C-a [  →  v / C-v / y
# ==============================

